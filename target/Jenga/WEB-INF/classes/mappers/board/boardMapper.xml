<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">		<!-- MyBatis의 경우 작성된 XML Mapper는 상단의 파일에서 사용하는 태그들에 대한 정보가 기록된 DTD를 추가 -->

<mapper namespace="board">

	<update id="addReadCount">
		UPDATE
			tbl_blockReadCount
		SET
			blrc_count = blrc_count + 1
		WHERE
			blrc_ref = #{bl_uid}
	</update>
<!-- TODO 수정 중 -->
	<select id="getView1" resultType="Map">
		SELECT
			B.bl_writer, B.bl_title, B.bl_description, B.bl_mainCtg, B.bl_smCtg, B.bl_date, B.bl_objId,
			I.bti_url, R.blrc_count, L.blk_
		FROM
			tbl_block B
			INNER JOIN
				tbl_thumbImg I
			ON
				B.bl_uid = I.bti_ref
			INNER JOIN
				tbl_blockReadCount R
			ON
				R.blrc_ref = B.bl_uid
			INNER JOIN
				tbl_blockLikes L
			ON
				L.
		WHERE
			B.bl_uid = #{bl_uid} AND R.blrc_ref = #{bl_uid}
	</select>

	<select id="getView2" resultType="String">
		SELECT
			bt_name
		FROM
			tbl_blockTags
		WHERE
			bt_ref = #{bl_uid}
	</select>

	<insert id="writeViewBlock">
		INSERT INTO
    		tbl_block
				(bl_uid, bl_writer, bl_title, bl_introduce, bl_description, bl_mainCtg, bl_smCtg, bl_date, bl_objId)
		VALUES
				(#{bl_uid}, #{bl_writer}, #{bl_title}, #{bl_introduce}, #{bl_description}, #{bl_mainCtg}, #{bl_smCtg}, #{bl_date}, #{bl_objId})
	</insert>

	<insert id="writeViewThumbImg">
		INSERT INTO
			tbl_thumbImg
				(bti_ref, bti_url)
		VALUES
				(#{bl_uid}, #{uploadName})
	</insert>

	<insert id="writeViewTag">
		INSERT INTO
			tbl_blockTags
				(bt_ref, bt_name)
		VALUES
				(#{bl_uid}, #{tag})
	</insert>
    <!-- 조회수 테이블 초기화 -->
	<insert id="writeViewReadCount">
		INSERT INTO
			tbl_blockReadCount
				(blrc_ref)
		VALUES
				(#{bl_uid})
	</insert>

    <!-- 좋아요 증가 -->
	<insert id="addLike">
		INSERT INTO
			tbl_blockLikes
				(blk_ref)
        VALUES
				(#{bl_uid})
	</insert>

    <!-- 좋아요 취소 -->
	<delete id="cancelLike">
        DELETE FROM
            tbl_blockLikes
        WHERE
            blrc_ref = #{bl_uid}
    </delete>

	<select id="modifyViewGET" resultType="Map">
		SELECT
			B.bl_writer, B.bl_title, B.bl_description, B.bl_mainCtg, B.bl_smCtg, B.bl_date, B.bl_objId,
			I.bti_url
		FROM
			tbl_block B
			INNER JOIN
				tbl_thumbImg I
			ON
				B.bl_uid = I.bti_ref
		WHERE
			B.bl_uid = #{bl_uid}
	</select>

	<select id="modifyViewGET2" resultType="String">
		SELECT
			bt_name
		FROM
			tbl_blockTags
		WHERE
			bt_ref = #{bl_uid}
	</select>
	
	<select id="getUploadName" resultType="String">
		SELECT
			bti_url
		FROM
			tbl_thumbImg
		WHERE
			bti_ref = #{bl_uid}
	</select>

	<update id="modifyViewBoard">
		UPDATE
			tbl_block
		SET
			(bl_writer = #{bl_writer}, bl_title = #{bl_title}, bl_description = #{bl_description}, bl_mainCtg = #{bl_mainCtg}, bl_smCtg = #{bl_smCtg}, bl_date = #{bl_date}, bl_objId = #{bl_objId})
		WHERE
			bl_uid = #{bl_uid}
	</update>

	<update id="modifyViewThumbImg">
		UPDATE
			tbl_thumbImg
		SET
			bti_url = #{uploadName}
		WHERE
			bti_ref = #{bl_uid}
	</update>

	<update id="modifyViewTag">
		UPDATE
			tbl_blockTags
		SET
			bt_name = #{tag}
		WHERE
			bt_ref = #{bl_uid}
	</update>

	<select id="checkBmksPath" resultType="String">
		SELECT
			bp_path
		FROM
			tbl_blpath
		WHERE
			bp_iuid = #{session_iuid}
	</select>

	<insert id="insertBmksPath">
		INSERT INTO
			tbl_blpath
			(bp_iuid, bp_path, bp_date, bp_browstype, bp_booktype)
		VALUES
			(#{session_iuid}, #{blockPathDTO.bp_path}, sysdate, #{blockPathDTO.bp_browstype}, #{blockPathDTO.bp_booktype})
	</insert>

	<update id="updateBmksPath">
		UPDATE
			tbl_blpath
		SET
			bp_path = #{blockPathDTO.bp_path}, bp_date = sysdate, bp_browstype = #{blockPathDTO.bp_browstype}, bp_booktype = #{blockPathDTO.bp_booktype}
		WHERE
			bp_iuid = #{session_iuid}
	</update>

	<select id="getBookMarkFromHTML" resultType="String">
		SELECT
			bp_path
		FROM
			tbl_blpath
		WHERE
			bp_iuid = #{session_iuid}
	</select>

	<delete id="deleteBlock">
		DELETE FROM
			tbl_block
		WHERE
			bl_uid = #{bl_uid}
	</delete>

	<select id="mCtgAllUids" resultType="String">
		SELECT
			mctg_uid
		FROM
			tbl_mCategory
	</select>

	<select id="mCtgAllNames" resultType="String">
		SELECT
			mctg_name
		FROM
			tbl_mCategory
		WHERE
			mctg_uid = #{uid}
	</select>
	
	<select id="sCtgAllNames" resultType="String">
		SELECT
			sctg_name
		FROM
			tbl_sCategory
		WHERE
			sctg_ref = #{uid}
	</select>

	<select id="sctgUID" resultType="String">
		SELECT
			SCTG_UID
		FROM
		    tbl_SCATEGORY
		WHERE
		    SCTG_NAME = #{bl_smCtg}
	</select>

	<select id="mctgUID" resultType="String">
		SELECT
			MCTG_UID
		FROM
		    tbl_MCATEGORY
		WHERE
		    MCTG_NAME = #{bl_smCtg}
	</select>
	
</mapper>














